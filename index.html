<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Papers</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav>
        <div class="nav-container">
            <h1 class="logo">Find My Papers</h1>
            <a href="admin_login.php" class="admin-login">Admin Login</a>
        </div>
    </nav>

    <main>
        <h1>Find Past Papers</h1>
        <form action="search.php" method="GET">
            <label for="college">College:</label>
            <select id="college" name="college" required>
                <option value="Pandit Deendayal Energy University">Pandit Deendayal Energy University</option>
            </select>

            <label for="branch">Branch:</label>
            <select id="branch" name="branch" required>
                <option value="Computer Engineering">Computer Engineering</option>
                <option value="Information Technology">Information Technology</option>
                <option value="Mechanical Engineering">Mechanical Engineering</option>
                <option value="Chemical Engineering">Chemical Engineering</option>
                <option value="Petroleum Engineering">Petroleum Engineering</option>
                <option value="Electronic Communication Engineering">Electronic Communication Engineering</option>
            </select>

            <label for="present_year">College Year:</label>
            <select id="present_year" name="present_year" required>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
            </select>

            <label for="year">Year:</label>
            <select id="year" name="year" required>
                <option value="">Select a year</option>
            </select>

            <label for="subject">Subject:</label>
            <select id="subject" name="subject" required>
                <option value="">Select a subject</option>
            </select>

            <label for="type">Type:</label>
            <select id="type" name="type" required>
                <option value="Mid Sem">Mid Sem</option>
                <option value="End Sem">End Sem</option>
            </select>

            <button type="submit">Search</button>
        </form>

        <div id="results"></div>
    </main>

    <script>
        // Fetch available years based on selected college, branch, and present year
        function fetchYears() {
            const college = document.getElementById('college').value;
            const branch = document.getElementById('branch').value;
            const presentYear = document.getElementById('present_year').value;

            if (college && branch && presentYear) {
                const xhrYears = new XMLHttpRequest();
                xhrYears.open('GET', `search.php?college=${college}&branch=${branch}&present_year=${presentYear}&fetch_years=true`, true);
                xhrYears.onload = function () {
                    if (xhrYears.status === 200) {
                        const years = JSON.parse(xhrYears.responseText);
                        const yearDropdown = document.getElementById('year');
                        yearDropdown.innerHTML = '<option value="">Select a year</option>';
                        years.forEach(function (year) {
                            const option = document.createElement('option');
                            option.value = year;
                            option.textContent = year;
                            yearDropdown.appendChild(option);
                        });
                    }
                };
                xhrYears.send();
            }
        }

        // Fetch subjects based on selected criteria
        function fetchSubjects() {
            const college = document.getElementById('college').value;
            const branch = document.getElementById('branch').value;
            const presentYear = document.getElementById('present_year').value;
            const year = document.getElementById('year').value;

            if (college && branch && presentYear && year) {
                const xhrSubjects = new XMLHttpRequest();
                xhrSubjects.open('GET', `search.php?college=${college}&branch=${branch}&present_year=${presentYear}&year=${year}&fetch_subjects=true`, true);
                xhrSubjects.onload = function () {
                    if (xhrSubjects.status === 200) {
                        const subjects = JSON.parse(xhrSubjects.responseText);
                        const subjectDropdown = document.getElementById('subject');
                        subjectDropdown.innerHTML = '<option value="">Select a subject</option>';
                        subjects.forEach(function (subject) {
                            const option = document.createElement('option');
                            option.value = subject;
                            option.textContent = subject;
                            subjectDropdown.appendChild(option);
                        });
                    }
                };
                xhrSubjects.send();
            }
        }

        // Event listeners to trigger fetching years and subjects
        document.getElementById('college').addEventListener('change', fetchYears);
        document.getElementById('branch').addEventListener('change', fetchYears);
        document.getElementById('present_year').addEventListener('change', fetchYears);
        document.getElementById('year').addEventListener('change', fetchSubjects);

    </script>
</body>
</html>
